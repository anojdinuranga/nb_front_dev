<!DOCTYPE html>
<html lang="en">

<head>
    <title>Queen Kuweni - Register</title>
    <%- header_tags %>
        <style>
            html,
            body {
                overflow-x: hidden !important;
            }
        </style>
</head>

<body>

    <!------------------- navbar start--------------->
    <%- sidebar %>
        <!----------------- navbar end--------------->


        <!------------------ Login form ------------------>


        <section id="registerForm">
            <div class="w-full form-container">
                <div class="form-content">
                    <div class="d-flex justify-content-center">
                        <h6 class="Login-Or-register-text mb-5">Register</h6>
                    </div>
                    <div class="row loginemail" id="">
                        <div class="col-md-6 mb-2">
                            <input class="" type="text" id="first_name" placeholder="First Name *" />
                        </div>

                        <div class="col-md-6 mb-2">
                            <input class="" type="text" id="last_name" placeholder="Last Name *" />
                        </div>

                        <div class="col-md-12 mb-2">
                            <input class="" type="text" id="company" placeholder="Company" />
                        </div>

                        <div class="col-md-3 mb-2">
                            <select class="form-select" id="mobile_code">
                                <option value="94" selected>+94</option>
                                <option value="1">+1</option>
                                <option value="61">+61</option>
                                <option value="33">+33</option>
                                <option value="91">+91</option>
                                <option value="39">+39</option>
                                <option value="960">+960</option>
                                <option value="31">+31</option>
                                <option value="65">+65</option>
                                <option value="971">+971</option>
                                <option value="44">+44</option>
                                <option value="971">+971</option>
                                <option value="64">+64</option>
                                <option value="268">+268</option>
                                <option value="353">+353</option>
                                <option value="34">+34</option>
                                <option value="974">+974</option>
                                <option value="49">+49</option>
                                <option value="44">+44</option>
                                <option value="358">+358</option>
                            </select>
                        </div>

                        <div class="col-md-9 mb-2">
                            <input class="" type="number" id="mobile" placeholder="Mobile *"
                                oninput="formatMobileNumber(this)" />
                        </div>

                        <div class="col-md-12 mb-2">
                            <input class="" type="email" id="email" placeholder="Email" />
                        </div>

                        <div class="col-md-12 mb-2">
                            <input class="" type="password" id="password" placeholder="Password *" />
                        </div>

                        <div class="col-md-12">
                            <textarea class="form-control" id="address" rows="2"
                                placeholder="Shipping Address"></textarea>
                        </div>

                        <div class="col-md-12 text-end mt-2">
                            <a href="/login" class="register-form-link">Have an account? Login</a>
                        </div>




                        <!-- <p class="login-form-laber text-start">Please enter your email.</p> -->

                        <div class="mb-3 d-flex justify-content-center">
                            <button class="btn btn-dark text-white d-block mt-4 login-button"
                                onclick="register();">Register</button>
                        </div>
                    </div>

                    <div class="border-top mt-5 mt-lg-2 mt-xxl-5">
                        <div class="d-flex justify-content-center w-100 mt-5 mt-lg-2 mt-xxl-5">
                            <button type="button" class="btn login-button2 w-50 me-3" disabled>
                                <img src="assets/images/Login/Group.svg" class="img-fluid" alt="">
                            </button>

                            <!-- <button type="button" class="btn login-button2 w-50">
                                <img src="assets/images/Login/Vector.svg" class="img-fluid" alt="">
                            </button> -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="verifyForm" class="" style="display: none;">
            <div class="w-full form-container">
                <div class="form-content">
                    <div class="mb-5 text-center">
                        <h6 class="Login-Or-register-text mb-2">Please Verify Your Account</h6>
                        <p>Please enter the OTP you received on your mobile number.</p>
                    </div>
                    <div class="row w-100 loginemail" id="">

                        <div class="col-md-12 mb-2">
                            <input class="" type="number" id="otp" placeholder="Enter your OTP" />
                        </div>

                        <!-- <p class="login-form-laber text-start">Please enter your email.</p> -->

                        <div class="mb-3 d-flex justify-content-center">
                            <button class="btn btn-dark text-white d-block mt-4 login-button"
                                onclick="verify();">Verify</button>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!------------------ Login form End------------------>

        <!-- Footer Start-->
        <%- web_footer %>
            <!-- Footer End-->

            <!-- script start-->
            <script>
                function formatMobileNumber(input) {
                    // Remove any non-numeric characters
                    let mobileNumber = input.value.replace(/\D/g, '');

                    // If the number starts with 0, remove the leading 0
                    if (mobileNumber.startsWith('0')) {
                        mobileNumber = mobileNumber.substring(1);
                    }

                    // Update the input value
                    input.value = mobileNumber;
                }

                function register() {

                    $.ajax({
                        url: '/api/v1/user/register',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({

                            "firstName": $('#first_name').val(),
                            "lastName": $('#last_name').val(),
                            "email": $('#email').val(),
                            "company": $('#company').val(),
                            "address": $('#address').val(),
                            "mobileCode": $('#mobile_code').val(),
                            "mobile": $('#mobile').val(),
                            "password": $('#password').val()

                        }),
                        success: function (data) {
                            if (data.status === true || data.status === "true") {

                                iziToast.success({
                                    theme: 'dark',
                                    title: 'Success',
                                    message: data.message,
                                });

                                document.getElementById("registerForm").style.display = "none";
                                document.getElementById("verifyForm").style.display = "";

                            } else {

                                iziToast.error({
                                    theme: 'dark',
                                    title: 'Error',
                                    message: data.message,
                                });
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.error('Error making the request:', textStatus, errorThrown);
                            iziToast.error({
                                theme: 'dark',
                                title: 'Error',
                                message: 'An error occurred while processing your request.',
                            });
                        }
                    });
                }

                function verify() {

                    $.ajax({
                        url: '/api/v1/user/verify',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({

                            "mobileCode": $('#mobile_code').val(),
                            "mobile": $('#mobile').val(),
                            "mobileVerify": $('#otp').val()

                        }),
                        success: function (data) {
                            if (data.status === true || data.status === "true") {

                                iziToast.success({
                                    theme: 'dark',
                                    title: 'Success',
                                    message: data.message,
                                });
                                setTimeout(() => { window.location = "/login" }, 1000);

                            } else {

                                iziToast.error({
                                    theme: 'dark',
                                    title: 'Error',
                                    message: data.message,
                                });
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.error('Error making the request:', textStatus, errorThrown);
                            iziToast.error({
                                theme: 'dark',
                                title: 'Error',
                                message: 'An error occurred while processing your request.',
                            });
                        }
                    });
                }

            </script>
            <%- script_tags %>
                <!-- script start-->
</body>

</html>